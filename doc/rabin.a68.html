<!-- Header -->
<html>
<head>
<title>Algol 68 Genie</title>
<meta name="Keywords" content="algol,algol68,68,algol-68,algol68g,algol68-g,a68g,a68-g,68g,genie,interpreter">
<meta http-equiv="Content-Style-Type" content="text/css"; charset=ISO-8859-1">
<style type="text/css">
a:link    {color: blue; text-decoration: underline;}
a:visited {color: blue; text-decoration: underline;}
a:active  {color: blue; text-decoration: underline;}
p {font-size: 10pt; font-family: Arial,Helvetica;}
u {font-size: 10pt; font-family: Arial,Helvetica;}
dd {font-size: 10pt; font-family: Arial,Helvetica;}
h1 {font-size: 16pt; font-family: Arial,Helvetica;}
h2 {font-size: 14pt; font-family: Arial,Helvetica;}
h3 {font-size: 12pt; font-family: Arial,Helvetica;}
h4 {font-size: 10pt; font-family: Arial,Helvetica;}
td {font-size: 10pt; font-family: Arial,Helvetica;}
ul {font-size: 10pt; font-family: Arial,Helvetica;}
body {font-size: 10pt; font-family: Arial,Helvetica;}
code {font-size: 10pt; font-family: Courier;}
pre {font-size: 10pt; font-family: Courier;}
</style>
</head>

<body bgcolor="white">

<table width="100%" border=0 cellspacing=0 cellpadding=0>
<td width="100%" background="lines.gif">
<img src="lines.gif" align=right>
<small>
Documentation for Algol 68 Genie Mark 11
</small>
</td>
</table>


<table width="100%" border=0 cellspacing=0 cellpadding=0>
<td width="50%" valign=top bgcolor="white">
<br>
<h2>Example: Lucas-Lehmer test</h2>
</td>
<td width="30%" valign=top bgcolor="white">
<img src="algol68.gif">
</td>
<td width="5%" valign=top bgcolor="white">
</td>
<td width="15%" valign=top bgcolor="white">
<!-- Navigation bar -->
<table border="0" cellspacing="0" width="100%">
<tr>
<td background="lines.gif">
<b>Algol68G Mark 11</b>
<p>
&nbsp;&middot;&nbsp;<a href="contents.html"><small><b>Contents</b></small></a><br>
<p>
&nbsp;&middot;&nbsp;<a href="algol.html"><small>Introduction</small></a><br>
&nbsp;&middot;&nbsp;<a href="install.html"><small>Installation</small></a><br>
&nbsp;&middot;&nbsp;<a href="description.html"><small>Description</small></a><br>
&nbsp;&middot;&nbsp;<a href="examples.html"><small>Example&nbsp;programs</small></a><br>
&nbsp;&middot;&nbsp;<a href="synopsis.html"><small>Synopsis</small></a><br>
&nbsp;&middot;&nbsp;<a href="syntax.html"><small>Syntax</small></a><br>
<p>
&nbsp;&middot;&nbsp;<a href="resources.html"><small>A68 Resources</small></a><br>
&nbsp;&middot;&nbsp;<a href="algol.html#obtaining"><small>Downloads</small></a><br>
&nbsp;&middot;&nbsp;<a href="algol.html#contact"><small>Contact</small></a><br>
</td>
</tr>
</table>
<!-- End navigation bar -->
</td>
</table>

<pre>
COMMENT 
   This implements the Rabin-Miller primality test in Algol 68.
   If a number does not pass, it is not prime. 
   If a number passes, it is prime with approximate probability
   1 - (1 / 4) ^ max trials. Literature gives better choices for
   test numbers 'a' than used here.
COMMENT

INT max trials = 10, UNT p, m, pow := 2, INT b, MODE UNT = LONG LONG INT;

read (p);

# Disect the number under test in form p = (2 ^ b) * m + 1 #

FOR n WHILE pow < p
DO IF (p - 1) MOD pow = 0
   THEN b := n;
        m := (p - 1) OVER pow
   FI;
   pow *:= 2
OD;

printf (($lg(0), " = 2 ^ ", g(0), " * ", g(0), " + 1"$, p, b, m));

# Test primality #

BOOL go on := TRUE, is prime := TRUE;

TO max trials WHILE go on AND is prime
DO UNT a = 1 + ENTIER (next random * (p - 1));
   IF OP GCD = (UNT a, b) UNT:
         IF b = 0 
         THEN ABS a
         ELSE b GCD (a MOD b)
         FI;
      PRIO GCD = 6;
      p GCD a ~= 1
   THEN is prime := FALSE
   ELIF PROC up mod = (UNT a, b, m) UNT: # (a ^ b) MOD m #
        (UNT prod := 1, expo := b, pow := a MOD m;
         WHILE expo ~= 0
         DO IF expo MOD 2 = 1
            THEN prod := (prod * pow) MOD m
            FI;
            pow := pow ^ 2 MOD m;
            expo OVERAB 2
         OD;
         prod
        ); 
        UNT z := up mod (a, m, p);
        z = 1 OR z = p - 1
   THEN SKIP # pass #
   ELSE BOOL pass := FALSE;
        TO b WHILE NOT pass
        DO z := up mod (z, 2, p); 
           pass := z = p - 1
        OD;
	is prime := is prime AND pass
   FI
OD;

IF is prime
THEN printf (($lg(0)" is prime with approximate probability ", h$, p, 1.0 - 0.25 ^ max trials))
ELSE printf (($lg(0), " is a composite number"$, p))
FI


</pre>

<!-- Footer -->
<hr color=#e0e0e0>
<p>
<small>
Copyright &copy; 2001-2007 J. Marcel van der Veer.<br>
Algol 68 Genie Mark 11 (August 2007)
</small>
</p>
<hr color=#e0e0e0>

</body>
</html>

