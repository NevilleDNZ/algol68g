<!-- Header -->
<html>
<head>
<title>Algol 68 Genie</title>
<meta name="Keywords" content="algol,algol68,68,algol-68,algol68g,algol68-g,a68g,a68-g,68g,genie,interpreter">
<meta http-equiv="Content-Style-Type" content="text/css"; charset=ISO-8859-1">
<style type="text/css">
a:link    {color: blue; text-decoration: underline;}
a:visited {color: blue; text-decoration: underline;}
a:active  {color: blue; text-decoration: underline;}
p {font-size: 10pt; font-family: Arial,Helvetica;}
u {font-size: 10pt; font-family: Arial,Helvetica;}
dd {font-size: 10pt; font-family: Arial,Helvetica;}
h1 {font-size: 16pt; font-family: Arial,Helvetica;}
h2 {font-size: 14pt; font-family: Arial,Helvetica;}
h3 {font-size: 12pt; font-family: Arial,Helvetica;}
h4 {font-size: 10pt; font-family: Arial,Helvetica;}
td {font-size: 10pt; font-family: Arial,Helvetica;}
ul {font-size: 10pt; font-family: Arial,Helvetica;}
body {font-size: 10pt; font-family: Arial,Helvetica;}
code {font-size: 10pt; font-family: Courier;}
pre {font-size: 10pt; font-family: Courier;}
</style>
</head>

<body bgcolor="white">

<table width="100%" border=0 cellspacing=0 cellpadding=0>
<td width="100%" background="lines.gif">
<img src="lines.gif" align=right>
<small>
Documentation for Algol 68 Genie Mark 11
</small>
</td>
</table>


<table width="100%" border=0 cellspacing=0 cellpadding=0>
<td width="50%" valign=top bgcolor="white">
<br>
<h2>Example: Band-pass filter for sound files</h2>
</td>
<td width="30%" valign=top bgcolor="white">
<img src="algol68.gif">
</td>
<td width="5%" valign=top bgcolor="white">
</td>
<td width="15%" valign=top bgcolor="white">
<!-- Navigation bar -->
<table border="0" cellspacing="0" width="100%">
<tr>
<td background="lines.gif">
<b>Algol68G Mark 11</b>
<p>
&nbsp;&middot;&nbsp;<a href="contents.html"><small><b>Contents</b></small></a><br>
<p>
&nbsp;&middot;&nbsp;<a href="algol.html"><small>Introduction</small></a><br>
&nbsp;&middot;&nbsp;<a href="install.html"><small>Installation</small></a><br>
&nbsp;&middot;&nbsp;<a href="description.html"><small>Description</small></a><br>
&nbsp;&middot;&nbsp;<a href="examples.html"><small>Example&nbsp;programs</small></a><br>
&nbsp;&middot;&nbsp;<a href="synopsis.html"><small>Synopsis</small></a><br>
&nbsp;&middot;&nbsp;<a href="syntax.html"><small>Syntax</small></a><br>
<p>
&nbsp;&middot;&nbsp;<a href="resources.html"><small>A68 Resources</small></a><br>
&nbsp;&middot;&nbsp;<a href="algol.html#obtaining"><small>Downloads</small></a><br>
&nbsp;&middot;&nbsp;<a href="algol.html#contact"><small>Contact</small></a><br>
</td>
</tr>
</table>
<!-- End navigation bar -->
</td>
</table>

<pre>
COMMENT
  Band-pass filter for a sound file on a second-per-second basis using FFT.
  Limitations:
  (1) sound duration must be a whole number of seconds
  (2) sample rate must be even
COMMENT

#
  Get the sound file. 
#
SOUND w, FILE in, out;
print ((newline, "File: "));
STRING fn = read string;
open (in, fn + ".wav", standback channel);
get bin (in, w);
close (in);
print ((newline, "rate=", RATE w));
print ((newline, "samples=", SAMPLES w));
print ((newline, "bits=", RESOLUTION w));
print ((newline, "channels=", CHANNELS w));
INT secs = SAMPLES w OVER RATE w;
print ((newline, "duration=", secs));
# If next number is large, FFT is inefficient. #
print ((newline, "prime factors=", UPB prime factors (RATE w)));
#
  Get filter parameters. 
#
print ((newline, "low frequency: "));
REAL low f = read real;
print ((newline, "high frequency: "));
REAL high f = read real;
# 
  Apply a band filter. 
  Not the most efficient code, but obvious.
#
FOR i TO secs
DO print ((newline, i, collections, garbage));
   FOR j TO CHANNELS w
   DO #
        Get data for this second.
      #
      [RATE w] REAL samples;
      FOR k TO RATE w
      DO samples[k] := get sound (w, j, (i - 1) * RATE w + k)
      OD;
      # 
        Forward transform to determine spectrum. 
      #
      [RATE w] COMPLEX spectrum := fft forward (samples);
      # 
        Apply filter.
        Simplifications apply since the FFT is over one second,
        hence N*dt=1 and the frequencies are whole numbers.
      # 
      FOR m TO RATE w OVER 2 + 1
      DO # f2 is the corresponding negative frequency with f1. #
         INT f1 = m, f2 = (f1 = 1 | 1 | RATE w - f1 + 2);
         IF f1 < low f OR f1 > high f
         THEN spectrum[f1] := spectrum[f2] := 0
         FI
      OD;
      # 
        Restore sample data for this second. 
      #
      samples := fft inverse (spectrum);
      FOR k TO RATE w
      DO set sound (w, j, (i - 1) * RATE w + k, ENTIER samples[k])
      OD
   OD
OD;
#
  Put the filtered sound file. 
#
open (out, fn + ".fft.wav", standback channel);
put bin (out, w);
close (out)

</pre>

<!-- Footer -->
<hr color=#e0e0e0>
<p>
<small>
Copyright &copy; 2001-2007 J. Marcel van der Veer.<br>
Algol 68 Genie Mark 11 (November 2007)
</small>
</p>
<hr color=#e0e0e0>

</body>
</html>

